<!DOCTYPE html><html><head><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="57x57" href="/static/images/icons/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/static/images/icons/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/static/images/icons/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/static/images/icons/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/static/images/icons/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/static/images/icons/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/static/images/icons/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/static/images/icons/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/static/images/icons/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/static/images/icons/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/images/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/static/images/icons/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/images/icons/favicon-16x16.png"/><meta name="viewport" content="width=device-width"/><link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css"/><link rel="stylesheet" type="text/css" href="/static/css/bebasNeue.css"/><link rel="stylesheet" type="text/css" href="/static/css/animations.css"/><link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800|Roboto:100,300,400,500,700,900" rel="stylesheet"/><title>Actionhero</title><script src="/static/js/googleAnalytics.js"></script><meta name="next-head-count" content="21"/><link rel="preload" href="/_next/static/LBfMmkKIbhjxYUodTJOk3/pages/tutorials/%5Bname%5D.js" as="script"/><link rel="preload" href="/_next/static/LBfMmkKIbhjxYUodTJOk3/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-08f7b238829422e3b9b2.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.205aac1996ebb87d3a48.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-2325b25da04a50e601b5.js" as="script"/></head><body><div id="__next"><div><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300" class="container-fluid"><header style="background-color:#2F5266"><div class="container"><nav style="background-color:#2F5266;padding-top:5px;margin-bottom:10px;border:0" class="navbar navbar-default"><div class="container"><div class="navbar-header"><a style="padding-top:0;margin-bottom:15px" class="navbar-brand"><img src="/static/images/actionhero-logo-header-wordmark.svg" style="padding-top:14px;padding-bottom:20px"/></a><button type="button" class="navbar-toggle collapsed"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"></ul><ul class="hidden-md hidden-sm hidden-xs nav navbar-nav navbar-left"><li role="presentation" class=""><a role="button" href="#"> </a></li><li role="presentation" class=""><a role="button" href="#"> </a></li></ul><ul class="nav navbar-nav navbar-left"><li role="presentation" class="hidden-sm"><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Why Actionhero</span></a></li><li role="presentation" class=""><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Downloads</span></a></li><li role="presentation" class=""><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Tutorials</span></a></li><li role="presentation" class=""><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Documentation</span></a></li><li role="presentation" class="hidden-sm"><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Plugins</span></a></li><li role="presentation" class=""><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Community</span></a></li><li role="presentation" class=""><a role="button" href="#"><span style="line-height:3;color:#FFFFFF;padding-bottom:10px;font-weight:300">Shop</span></a></li></ul><ul class="nav navbar-nav navbar-right"><div><a style="text-decoration:none" href="/get-started"><button style="font-family:Roboto, sans-serif;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;font-weight:300;margin-top:20px;margin-bottom:0;margin-left:10px;margin-right:10px;outline:none" type="button" class="btn btn-lg btn-default btn-block">Get Started</button></a></div></ul></div></div></nav></div></header></div><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300" class="container-fluid"><div style="background-color:#FBF9E4;color:#2F5266;font-weight:200;padding:50px"><div class="container"><div class="row"><div style="text-align:center" class="col-md-3"><img src="/static/images/documentation.svg"/></div><div style="text-align:center" class="col-md-6"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px"><br/>Upgrade-path</h1></div><div class="col-md-3"></div></div></div></div><div style="height:183px;background:url(&quot;/static/images/clouds-white.svg&quot;) no-repeat center #FBF9E4"></div><div style="padding-bottom:100px" class="container"><div class="row"><div id="_top"></div><div id="docPageContent" class="col-md-12"><div class="row"><div class="col-md-9"><div><br/><h2 id="Overview" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Overview</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p>Upgrading big Actionhero projects to a new major might require some effort. Every Actionhero version has it&#x27;s own specific project files which you generate using <code>Actionhero generate</code> command.</p><p>One of the ways to upgrade your project is to generate a new project using the latest Actionhero framework (<code>npm install Actionhero &amp;&amp; npx Actionhero generate</code>). Using that as your starting point you can then carefully copy all your <code>configs</code>, <code>initializers</code>, <code>servers</code>, <code>tasks</code>, <code>actions</code>, and other custom code from your old project, making sure that you are at the same working state as before. It&#x27;s a good practice to make tests for your actions (or any other component) before you plan to upgrade your Actionhero project.</p><p>With good <a href="tutorial-testing.html">test coverage</a> you can make sure that you have successfully upgraded your project.</p><p>Actionhero follows <a href="http://semver.org/">semantic versioning</a>. This means that a minor change is a right-most number. A new feature added is the middle number, and a breaking change is the left number. You should expect something in your application to need to be changed if you upgrade a major version.</p><div><br/><h2 id="Upgrading from v20 to v21" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v20 to v21</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p>WIP: This is a large change to Typescript. Detailed notes can be found on the Typescript page.</p><div><br/><h2 id="Upgrading from v19 to v20" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v19 to v20</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v20.0.0">GitHub</a></strong></p><p>The only change to take note of is that you must now ensure that the working directory (CWD/PWD) in use when you start your Actionhero project is the root. (where /config, /actions, etc) are visable.</p><div><br/><h2 id="Upgrading from v18 to v19" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v18 to v19</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v19.0.0">GitHub</a></strong></p><p><strong>Configuration</strong></p><ul><li>in <code>config/tasks.js</code> <code>add api.config.tasks.stuckWorkerTimeout = 3600000</code>. This will be a 1 hour timeout for stuck/crashed worker processes</li><li>in <code>config/servers/websocket.js</code> <code>add api.config.servers.websocket.client.cookieKey = api.config.servers.web.fingerprintOptions.cookieKey</code>. This will instruct the Actionhero Websocket Clients to share the same cookie as the web server to share a fingerprint, which can be used to share session information.</li><li>If you plan to use Jest for your tests, and want to test in parallel, you will need to configure your server in the test environment to make use of <code>process.env.JEST_WORKER_ID</code>. Please view <a href="https://github.com/Actionhero/Actionhero/blob/master/config/api.js"><code>config/api.js</code></a>, <a href="https://github.com/Actionhero/Actionhero/blob/master/config/redis.js"><code>config/redis.js</code></a>, <a href="https://github.com/Actionhero/Actionhero/blob/master/config/servers/socket.js"><code>config/servers/socket.js</code></a>, and <a href="https://github.com/Actionhero/Actionhero/blob/master/config/servers/web.js"><code>config/servers/web.js</code></a> for more information</li></ul><div><br/><h2 id="Upgrading from v19 to v20" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v19 to v20</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v20.0.0">GitHub</a></strong></p><ul><li>In <code>config/api.js</code> add <code>api.config.general.paths.test = [path.join(__dirname, &#x27;/../__tests__&#x27;)]</code> so that when you generate a new action or task, the related test file can be generated as well.</li><li>However you run Actionhero, be sure to <code>cd</code> into the root directory of the project before starting the server.</li></ul><div><br/><h2 id="Upgrading from v19 to v20" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v19 to v20</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v19.0.0">GitHub</a></strong></p><ul><li>in <code>config/tasks.js</code> <code>add api.config.tasks.stuckWorkerTimeout = 3600000</code>. This will be a 1 hour timeout for stuck/crashed worker processes</li><li>in <code>config/servers/websocket.js</code> <code>add api.config.servers.websocket.client.cookieKey = api.config.servers.web.fingerprintOptions.cookieKey</code>. This will instruct the Actionhero Websocket Clients to share the same cookie as the web server to share a fingerprint, which can be used to share session information.</li><li>If you plan to use Jest for your tests, and want to test in parallel, you will need to configure your server in the test environment to make use of <code>process.env.JEST_WORKER_ID</code>. Please view <a href="https://github.com/Actionhero/Actionhero/blob/master/config/api.js"><code>config/api.js</code></a>, <a href="https://github.com/Actionhero/Actionhero/blob/master/config/redis.js"><code>config/redis.js</code></a>, <a href="https://github.com/Actionhero/Actionhero/blob/master/config/servers/socket.js"><code>config/servers/socket.js</code></a>, and <a href="https://github.com/Actionhero/Actionhero/blob/master/config/servers/web.js"><code>config/servers/web.js</code></a> for more information</li></ul><div><br/><h2 id="Upgrading from v17 to v18" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v17 to v18</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v18.0.0">GitHub</a></strong></p><p><strong>Breaking Changes and How to Overcome Them:</strong></p><p>There are <em>many</em> changes to the APIs Actionhero exposes. You can read up on the new syntax on our <a href="https://docs.actionherojs.com">new documentation website, docs.actionherojs.com</a></p><ul><li><p><strong>Node.js version</strong></p><ul><li>Node.js v8 and higher is now required. You must update your projects.</li></ul></li><li><p><strong>Actions</strong></p><ul><li>Actions are now ES6 classes, which extend <code>require(&#x27;Actionhero&#x27;).Action</code>.</li><li>The <code>run</code> method only has one argument now, <code>data</code> and becomes a <code>async</code> method. <code>api</code> can be required globally to your file.</li></ul></li></ul><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span style="color:#954121">const</span> { Action, api } = <span style="color:#0086b3">require</span>(<span style="color:#219161">&quot;Actionhero&quot;</span>);

<span style="color:#0086b3">module</span>.exports = <span class="hljs-class"><span style="color:#954121">class</span> <span style="color:#458;font-weight:bold">MyAction</span> <span style="color:#954121">extends</span> <span style="color:#458;font-weight:bold">Action</span> </span>{
  <span style="color:#954121">constructor</span>() {
    <span style="color:#954121">super</span>();
    <span style="color:#954121">this</span>.name = <span style="color:#219161">&quot;randomNumber&quot;</span>;
    <span style="color:#954121">this</span>.description = <span style="color:#219161">&quot;I am an API method which will generate a random number&quot;</span>;
    <span style="color:#954121">this</span>.outputExample = { <span class="hljs-attr">randomNumber</span>: <span style="color:#40a070">0.1234</span> };
  }

  <span style="color:#954121">async</span> run(data) {
    data.response.randomNumber = <span style="color:#0086b3">Math</span>.random();
  }
};</code></pre><ul><li><strong>Tasks</strong><ul><li>Tasks are now ES6 classes, which extend <code>require(&#x27;Actionhero&#x27;).Task</code>.</li><li>The <code>run</code> method only has one argument now, <code>data</code> and becomes a <code>async</code> method. <code>api</code> can be required globally to your file.</li></ul></li></ul><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span style="color:#954121">const</span> { api, Task } = <span style="color:#0086b3">require</span>(<span style="color:#219161">&quot;Actionhero&quot;</span>);

<span style="color:#0086b3">module</span>.exports = <span class="hljs-class"><span style="color:#954121">class</span> <span style="color:#458;font-weight:bold">SendWelcomeMessage</span> <span style="color:#954121">extends</span> <span style="color:#458;font-weight:bold">Task</span> </span>{
  <span style="color:#954121">constructor</span>() {
    <span style="color:#954121">super</span>();
    <span style="color:#954121">this</span>.name = <span style="color:#219161">&quot;SendWelcomeEmail&quot;</span>;
    <span style="color:#954121">this</span>.description = <span style="color:#219161">&quot;I send the welcome email to new users&quot;</span>;
    <span style="color:#954121">this</span>.frequency = <span style="color:#40a070">0</span>;
    <span style="color:#954121">this</span>.queue = <span style="color:#219161">&quot;high&quot;</span>;
    <span style="color:#954121">this</span>.middleware = [];
  }

  <span style="color:#954121">async</span> run(data) {
    <span style="color:#954121">await</span> api.sendWelcomeEamail({ <span class="hljs-attr">address</span>: data.email });
    <span style="color:#954121">return</span> <span style="color:#954121">true</span>;
  }
};</code></pre><ul><li><strong>Initializers</strong><ul><li>Initializers are now ES6 classes, which extend <code>require(&#x27;Actionhero&#x27;).Initializer</code>.</li><li>The <code>initialize</code>, <code>start</code>, and <code>stop</code> methods now have no arguments and become a <code>async</code> methods. <code>api</code> can be required globally to your file.</li></ul></li></ul><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span style="color:#954121">const</span> { Actionhero, api } = <span style="color:#0086b3">require</span>(<span style="color:#219161">&quot;Actionhero&quot;</span>);

<span style="color:#0086b3">module</span>.exports = <span class="hljs-class"><span style="color:#954121">class</span> <span style="color:#458;font-weight:bold">StuffInit</span> <span style="color:#954121">extends</span> <span style="color:#458;font-weight:bold">Actionhero</span>.<span style="color:#458;font-weight:bold">Initializer</span> </span>{
  <span style="color:#954121">constructor</span>() {
    <span style="color:#954121">super</span>();
    <span style="color:#954121">this</span>.name = <span style="color:#219161">&quot;StuffInit&quot;</span>;
    <span style="color:#954121">this</span>.loadPriority = <span style="color:#40a070">1000</span>;
    <span style="color:#954121">this</span>.startPriority = <span style="color:#40a070">1000</span>;
    <span style="color:#954121">this</span>.stopPriority = <span style="color:#40a070">1000</span>;
  }

  <span style="color:#954121">async</span> initialize() {
    api.StuffInit = {};
    api.StuffInit.doAThing = <span style="color:#954121">async</span> () =&gt; {};
    api.StuffInit.stopStuff = <span style="color:#954121">async</span> () =&gt; {};
    api.log(<span style="color:#219161">&quot;I initialized&quot;</span>, <span style="color:#219161">&quot;debug&quot;</span>, <span style="color:#954121">this</span>.name);
  }

  <span style="color:#954121">async</span> start() {
    <span style="color:#954121">await</span> api.StuffInit.startStuff();
    api.log(<span style="color:#219161">&quot;I started&quot;</span>, <span style="color:#219161">&quot;debug&quot;</span>, <span style="color:#954121">this</span>.name);
  }

  <span style="color:#954121">async</span> stop() {
    <span style="color:#954121">await</span> api.StuffInit.stopStuff();
    api.log(<span style="color:#219161">&quot;I stopped&quot;</span>, <span style="color:#219161">&quot;debug&quot;</span>, <span style="color:#954121">this</span>.name);
  }
};</code></pre><ul><li><strong>Servers</strong><ul><li>Servers are now ES6 classes, which extend <code>require(&#x27;Actionhero&#x27;).Server</code>.</li><li>The <code>initialize</code>, <code>start</code>, and <code>stop</code> methods now have no arguments and become a <code>async</code> methods. <code>api</code> can be required globally to your file.</li></ul></li></ul><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span style="color:#954121">const</span> Actionhero = <span style="color:#0086b3">require</span>(<span style="color:#219161">&quot;Actionhero&quot;</span>);

<span style="color:#0086b3">module</span>.exports = <span class="hljs-class"><span style="color:#954121">class</span> <span style="color:#458;font-weight:bold">MyServer</span> <span style="color:#954121">extends</span> <span style="color:#458;font-weight:bold">Actionhero</span>.<span style="color:#458;font-weight:bold">Server</span> </span>{
  <span style="color:#954121">constructor</span>() {
    <span style="color:#954121">super</span>();
    <span style="color:#954121">this</span>.type = <span style="color:#219161">&quot;%%name%%&quot;</span>;

    <span style="color:#954121">this</span>.attributes = {
      <span class="hljs-attr">canChat</span>: <span style="color:#954121">false</span>,
      <span class="hljs-attr">logConnections</span>: <span style="color:#954121">true</span>,
      <span class="hljs-attr">logExits</span>: <span style="color:#954121">true</span>,
      <span class="hljs-attr">sendWelcomeMessage</span>: <span style="color:#954121">false</span>,
      <span class="hljs-attr">verbs</span>: []
    };
    <span style="color:#408080;font-style:italic">// this.config will be set to equal api.config.servers[this.type]</span>
  }

  initialize() {
    <span style="color:#954121">this</span>.on(<span style="color:#219161">&quot;connection&quot;</span>, conection =&gt; {});

    <span style="color:#954121">this</span>.on(<span style="color:#219161">&quot;actionComplete&quot;</span>, data =&gt; {});
  }

  start() {
    <span style="color:#408080;font-style:italic">// this.buildConnection (data)</span>
    <span style="color:#408080;font-style:italic">// this.processAction (connection)</span>
    <span style="color:#408080;font-style:italic">// this.processFile (connection)</span>
  }

  stop() {}

  sendMessage(connection, message, messageId) {}

  sendFile(connection, error, fileStream, mime, length, lastModified) {}

  goodbye(connection) {}
};</code></pre><ul><li><strong>CLI Commands</strong><ul><li>CLI Commands are now ES6 classes, which extend <code>require(&#x27;Actionhero&#x27;).CLI</code>.</li><li>The <code>run</code> method now has one argument, <code>data</code> and becomes a <code>async</code> method. <code>api</code> can be required globally to your file.</li></ul></li></ul><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span style="color:#954121">const</span> {api, CLI} = <span style="color:#0086b3">require</span>(<span style="color:#219161">&#x27;Actionhero&#x27;</span>)

<span style="color:#0086b3">module</span>.exports = <span class="hljs-class"><span style="color:#954121">class</span> <span style="color:#458;font-weight:bold">RedisKeys</span> <span style="color:#954121">extends</span> <span style="color:#458;font-weight:bold">CLI</span> </span>{
  <span style="color:#954121">constructor</span> () {
    <span style="color:#954121">super</span>()
    <span style="color:#954121">this</span>.name = <span style="color:#219161">&#x27;redis keys&#x27;</span>
    <span style="color:#954121">this</span>.description = <span style="color:#219161">&#x27;I list all the keys in redis&#x27;</span>
    <span style="color:#954121">this</span>.example = <span style="color:#219161">&#x27;Actionhero keys --prefix Actionhero&#x27;</span>
  }

  inputs () {
    <span style="color:#954121">return</span> {
      <span class="hljs-attr">prefix</span>: {
        <span class="hljs-attr">requried</span>: <span style="color:#954121">true</span>,
        <span class="hljs-attr">default</span>: <span style="color:#219161">&#x27;Actionhero&#x27;</span>,
        <span class="hljs-attr">note</span>: <span style="color:#219161">&#x27;the redis prefix for searching keys&#x27;</span>
      }
    }
  }

  <span style="color:#954121">async</span> run ({params}) =&gt; {
    <span style="color:#954121">let</span> keys = <span style="color:#954121">await</span> api.redis.clients.client.keys(params.prefix)
    api.log(<span style="color:#219161">&#x27;Found &#x27;</span> + keys.length + <span style="color:#219161">&#x27;keys:&#x27;</span>)
    keys.forEach(<span class="hljs-function">(<span style="color:#00f">k</span>) =&gt;</span> { api.log(k) })
  }
}</code></pre><ul><li><p><strong>Cache</strong></p><ul><li>All methods which used to return a callback are now <code>async</code> methods which, when <code>await</code>ed, return a result and <code>throw</code> errors</li></ul></li><li><p><strong>Tasks</strong></p><ul><li>All methods which used to return a callback are now <code>async</code> methods which, when <code>await</code>ed, return a result and <code>throw</code> errors</li></ul></li><li><p><strong>Chat</strong></p><ul><li>All methods which used to return a callback are now <code>async</code> methods which, when <code>await</code>ed, return a result and <code>throw</code> errors</li></ul></li><li><p><strong>SpecHelper</strong></p><ul><li>All methods which used to return a callback are now <code>async</code> methods which, when <code>await</code>ed, return a result and <code>throw</code> errors</li></ul></li></ul><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span style="color:#954121">const</span> chai = <span style="color:#0086b3">require</span>(<span style="color:#219161">&quot;chai&quot;</span>);
<span style="color:#954121">const</span> dirtyChai = <span style="color:#0086b3">require</span>(<span style="color:#219161">&quot;dirty-chai&quot;</span>);
<span style="color:#954121">const</span> expect = chai.expect;
chai.use(dirtyChai);

<span style="color:#954121">const</span> path = <span style="color:#0086b3">require</span>(<span style="color:#219161">&quot;path&quot;</span>);
<span style="color:#954121">const</span> Actionhero = <span style="color:#0086b3">require</span>(<span style="color:#219161">&quot;Actionhero&quot;</span>);
<span style="color:#954121">const</span> Actionhero = <span style="color:#954121">new</span> Actionhero.Process();
<span style="color:#954121">let</span> api;

describe(<span style="color:#219161">&quot;Action: RandomNumber&quot;</span>, () =&gt; {
  before(<span style="color:#954121">async</span> () =&gt; {
    api = <span style="color:#954121">await</span> Actionhero.start();
  });
  after(<span style="color:#954121">async</span> () =&gt; {
    <span style="color:#954121">await</span> Actionhero.stop();
  });

  <span style="color:#954121">let</span> firstNumber = <span style="color:#954121">null</span>;
  it(<span style="color:#219161">&quot;generates random numbers&quot;</span>, <span style="color:#954121">async</span> () =&gt; {
    <span style="color:#954121">let</span> { randomNumber } = <span style="color:#954121">await</span> api.specHelper.runAction(<span style="color:#219161">&quot;randomNumber&quot;</span>);
    expect(randomNumber).to.be.at.least(<span style="color:#40a070">0</span>);
    expect(randomNumber).to.be.at.most(<span style="color:#40a070">1</span>);
    firstNumber = randomNumber;
  });

  it(<span style="color:#219161">&quot;is unique / random&quot;</span>, <span style="color:#954121">async</span> () =&gt; {
    <span style="color:#954121">let</span> { randomNumber } = <span style="color:#954121">await</span> api.specHelper.runAction(<span style="color:#219161">&quot;randomNumber&quot;</span>);
    expect(randomNumber).to.be.at.least(<span style="color:#40a070">0</span>);
    expect(randomNumber).to.be.at.most(<span style="color:#40a070">1</span>);
    expect(randomNumber).not.to.equal(firstNumber);
  });
});</code></pre><ul><li><p><strong>Utils</strong></p><ul><li><code>api.utils.recursiveDirectoryGlob</code> has been removed in favor of the <a href="https://github.com/isaacs/node-glob">glob package</a>. Use this instead.</li><li>All methods which used to return a callback are now <code>async</code> methods which, when <code>await</code>ed, return a result and <code>throw</code> errors</li></ul></li><li><p><strong>Plugins</strong></p><ul><li>Actionhero no longer uses linkfiles to find plugins. If you have any in a <code>plugins</code> directory in your actions, tasks, config, or public folders, delete them.</li><li>Plugins now need to be defined explicitly in a new <code>./config/plugins.js</code> config file. You should create one <a href="https://github.com/Actionhero/Actionhero/blob/master/config/plugins.js">per the example</a></li><li>Removed <code>Actionhero link</code> and <code>Actionhero unlink</code> per the above.</li><li>Added <code>Actionhero generate plugin</code>, a helper which you can use in an empty directory which will create a template plugin project</li><li>Testing plugins is now simpler. <a href="https://docs.actionherojs.com/tutorial-plugins.html">Read more about this on docs.actionherojs.com</a></li></ul></li><li><p><strong>Clients</strong></p><ul><li><code>ActionheroClient</code> (the included client library for browser websocket clients) as been named a more clear <code>ActionheroWebsocketClient</code> to avoid ambiguity.</li><li>The node sever-sever package has been renamed <code>Actionhero-node-client</code> to help clear up any confusion.</li></ul></li></ul><div><br/><h2 id="Upgrading from v16 to v17" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v16 to v17</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v17.0.0">GitHub</a></strong></p><p><strong>Breaking Changes and How to Overcome Them:</strong></p><ul><li><p><strong>Localization (i18n)</strong></p></li><li><p>In <code>./config/i18n.js</code> be sure to enable <code>objectNotation</code>, or else the new locale file will be gibberish to Actionhero</p></li><li><p>As of this release, Actionhero no longer localizes its log messages. This is done to simplify and speed up the logger methods. There is not mitigation path here without overwriting the <code>api.log()</code> method.</p></li><li><p>Any use of <code>%</code> interpolation should be removed from your logger strings. Favor native JS string templates.</p></li><li><p>Actionhero now ships with locale files by default.</p></li><li><p>You will need to acquire the <a href="https://github.com/Actionhero/Actionhero/blob/master/locales/en.json">default locale file</a> and copy it into <code>./locales/en.json</code> within your project.</p></li><li>The error reporters have all been changed to use these new locale file and mustache-style syntax. Update your from the <a href="https://github.com/Actionhero/Actionhero/blob/master/config/errors.js">default errors file</a></li><li><p>The <code>welcomeMessage</code> and <code>goodbyeMessage</code> are removed from the config files and Actionhero now refrences the locale files for these strings. Update yours accodingly.</p></li><li><p><strong>utils</strong></p></li><li><p><code>api.utils.recursiveDirectoryGlob</code> has been removed in favor of the <a href="https://github.com/isaacs/node-glob">glob package</a>. Use this instead.</p></li></ul><div><br/><h2 id="Upgrading from v15 to v16" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v15 to v16</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v16.0.0">GitHub</a></strong></p><p><strong>Breaking Changes and How to Overcome Them:</strong></p><p>The only breaking changes are related to the capilization of internal methods:</p><ul><li><code>api.Connecton()</code> rather than <code>api.connection()</code></li><li><code>api.GenericServer()</code> rather than <code>api.genericServer()</code></li><li><code>api.ActionProcessor()</code> rather than <code>api.actionProcessor()</code></li><li><code>require(&#x27;Actionhero&#x27;)</code> not <code>require(&#x27;Actionhero&#x27;).actionheroPrototype</code> should you be using Actionhero programatically.</li></ul><div><br/><h2 id="Upgrading from v14 to v15" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v14 to v15</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v15.0.0">GitHub</a></strong></p><p><strong>Breaking Changes and How to Overcome Them:</strong></p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code>\`Actionhero generateAction --name=[name]\`      -&gt; \`Actionhero generate action --name=[name]\`
\`Actionhero generateInitializer --name=[name]\` -&gt; \`Actionhero generate initializer --name=[name]\`
\`Actionhero generateServer --name=[name]\`      -&gt; \`Actionhero generate server --name=[name]\`
\`Actionhero generateTask --name=[name]\`        -&gt; \`Actionhero generate task --name=[name]\`</code></pre><ul><li>The Actionhero binary has had it&#x27;s commands changed.<ul><li>Any deployment or automation tools you use will need to be updated accordingly.</li></ul></li><li>Tasks now use middleware instead of plugins.<ul><li>You will need to convert all uses of task plugins to task middleware.</li></ul></li></ul><div><br/><h2 id="Upgrading from v13 to v14" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v13 to v14</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v14.0.0">GitHub</a></strong></p><p><strong>Breaking Changes and How to Overcome Them:</strong></p><ul><li>Redis Client Configurations have changed drastically. This allows for greater configuration, but at a complexity cost.<ul><li>The easiest way to upgrade your <code>config/redis.js</code> is to take if from the <a href="https://github.com/Actionhero/Actionhero/blob/master/config/redis.js">master branch</a> directly and re-apply your configuration.</li><li>Move <code>api.config.redis.channel</code> to <code>api.config.general.channel</code></li><li>Move <code>api.config.redis. rpcTimeout</code> to <code>api.config.general.rpcTimeout</code></li><li>Throughout the code, use <code>api.config.redis.client</code> rather than <code>api.redis.client</code></li></ul></li></ul><div><br/><h2 id="Upgrading from v12 to v13" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v12 to v13</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v13.0.0">GitHub</a></strong></p><p><strong>Breaking Changes and How to Overcome Them:</strong></p><ul><li>Pluggins<ul><li><code>config/plugins.js</code> is removed. Delete yours.</li><li>Use the new binary command, <code>Actionhero link --name=NameOfPlugin</code> to link your plugins in the new method.</li><li>Linking plugins will likley create new config files you may need to customize.</li></ul></li><li>Locales<ul><li>This release introduced Locales. You will need the new locale config file. The easiest way to upgrade your <code>config/i18n.js</code> is to take if from the <a href="https://github.com/Actionhero/Actionhero/blob/master/config/i18n.js">master branch</a>.</li><li>Ensure that <code>api.config.i18n.updateFiles</code> is <code>true</code> so that your locale files can be generated for the first time.</li></ul></li><li>Errors<ul><li><code>config/errors.js</code> has been completely redone to take advantage of <code>connection.localize</code>. The easiest way to upgrade your <code>config/errors.js</code> is to take if from the <a href="https://github.com/Actionhero/Actionhero/blob/master/config/errors.js">master branch</a>.</li></ul></li><li>Grunt Removed<ul><li>Grunt is removed from the project. The old Actionhero grunt commands have been moved into the Actionhero binary.</li></ul></li><li>Redis configuration<ul><li><code>package</code> is a reserved keyword in JavaScript. We now use the key <code>pkg</code> in the redis config.</li></ul></li></ul><div><br/><h2 id="Upgrading from v11 to v12" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v11 to v12</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v12.0.0">GitHub</a></strong></p><p><strong>Breaking Changes and How to Overcome Them:</strong></p><ul><li>Redis configuration<ul><li>Switch from using the <code>redis</code> npm pacakge to <code>ioredis</code>. Change this in your package.json.</li></ul></li><li><code>ioredis</code> handles passwords slightly differently. Read the <a href="https://github.com/luin/ioredis">ioredis</a> documentation to learn more.</li><li>Stats Removed<ul><li>The <code>api.stats</code> subsection has been removed from Actionhero</li><li>If you need the stats subsection, you can get get it <a href="https://github.com/Actionhero/ah-stats-plugin">via plugin</a></li></ul></li></ul><div><br/><h2 id="Upgrading from v10 to v11" style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="font-weight:300;font-size:36px">Upgrading from v10 to v11</span></h2><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/></div><p><strong>Full Release Notes: <a href="https://github.com/Actionhero/Actionhero/releases/tag/v11.0.0">GitHub</a></strong></p><p><strong>Breaking Changes and How to Overcome Them:</strong></p><ul><li>Action Syntax changed<ul><li><code>run: function(api, data, next){ data.response.randomNumber = Math.random(); next(error); }</code></li><li>Where data contains:</li><li><code>data = { connection: connection, action: &#x27;randomNumber&#x27;, toProcess: true, toRender: true, messageId: 123, params: { action: &#x27;randomNumber&#x27;, apiVersion: 1 }, actionStartTime: 123, response: {}, }</code></li><li>You will need to change all of your actions to use <code>data.connection</code> rather than <code>connection</code> directly.</li><li>You will need to change all of your actions to use <code>data.response</code> rather than <code>connection.response</code> directly.</li></ul></li><li>Middleware syntax has changed to match action&#x27;s <code>data</code> pattern. You will need to change your middleware accordingly.</li><li>Removed <code>connection._originalConnection</code>.</li><li>Websockets:<ul><li>The params of websocket connections should NOT be sticky. All actions will start with <code>connection.params = {}</code>. If you rely on the old behavior, you will need to change your client code.</li></ul></li><li>Action Processor:<ul><li>Removed duplicate callback prevention in ActionProcessor. This belongs on the user/implementer to handle.</li></ul></li></ul></div><div class="col-md-3"><div style="padding-top:90px"><ul style="list-style-type:none;padding-left:0;margin-left:0"></ul></div></div></div><hr/><p>Back to<!-- --> <a href="/tutorials">Tutorials</a></p></div><div class="hidden-xs hidden-sm col-md-3"></div></div></div><div style="background-color:#6E8898;color:#2F5266;font-weight:300;padding-top:100px;padding-bottom:100px"><div class="container"><div class="row"><div class="col-md-2"></div><div style="text-align:center;color:#FBF9E4;padding-bottom:100px" class="col-md-8"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Solutions</h1><h2 style="font-family:Roboto, sans-serif;font-weight:300;font-size:20px;line-height:1.5em;color:#3B5D72"><span style="color:#FBF9E4">Actionhero was built from the ground up to include all the features you expect from a modern API framework.</span></h2></div><div class="col-md-2"></div></div><div class="row"><div class="col-md-4"><div style="width:100%;padding-top:40px;padding-bottom:40px;padding-left:40px;padding-right:50px;background-color:#FBF9E4;box-shadow:0px 2px 4px #003C51"><div style="text-align:center;padding-bottom:10px"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Open Source</h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>The Actionhero server is open source, under the Apache-2 license</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>Actionhero runs on Linux, OS X, and Windows</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>You always have access to the Actionhero team via<!-- --> <a href="/community">Slack and Github</a></p><br/><br/><div><a style="text-decoration:none" href="/downloads"><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-lg btn-default btn-block">Download</button></a></div></div></div><div class="hidden-md hidden-lg hidden-xl col-md-4"><div style="width:100%;padding:20px;background-color:#2F5266;color:#FFFFFF;box-shadow:0px 2px 4px #003C51"><div style="text-align:center"><img src="/static/images/dog.svg"/><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px"><span style="color:#FBF9E4">Premium Training &amp; Review</span></h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We provide support for corporate &amp; nonprofit customers starting at a flat rate of $150/hr. Our services include:</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><ul><li><strong>Remote training for your team</strong></li><li><strong>Code Reviews</strong></li><li><strong>Best Practices Audits</strong></li><li><strong>Custom plugin &amp; Feature Development</strong></li></ul><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We have packages appropriate for all company sizes. Contact us to learn more.</p><br/><div><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-lg btn-default btn-block">Contact Us</button></div></div></div><div class="hidden-xs hidden-sm col-md-4"><div style="width:125%;padding:40px;background-color:#2F5266;color:#FFFFFF;position:relative;top:-60px;box-shadow:0px 2px 4px #003C51;margin-left:-13%;margin-right:-5%;z-index:10"><div style="text-align:center;padding-bottom:10px"><img src="/static/images/dog.svg"/><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Premium Training &amp; Review</h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We provide support for corperate &amp; nonprofit customers starting at a flat rate of $150/hr. Our services include:</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><ul><li><strong>Remote training for your team</strong></li><li><strong>Code Reviews</strong></li><li><strong>Best Practices Workshops</strong></li><li><strong>Custom plugin &amp; Feature Development</strong></li></ul><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>We have packages appropriate for all company sizes. Contact us to learn more.</p><br/><div><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-lg btn-default btn-block">Contact Us</button></div></div></div><div class="col-md-4"><div style="width:100%;padding-top:40px;padding-bottom:40px;padding-right:40px;padding-left:50px;background-color:#FBF9E4;box-shadow:0px 2px 4px #003C51"><div style="text-align:center;padding-bottom:10px"><h1 style="font-family:BebasNeue, Roboto, sans-serif;font-weight:bold;margin-top:20px;margin-bottom:10px;letter-spacing:2px;font-size:36px">Enterprise</h1></div><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><p>For larger customers in need of a support contract, we offer an enterprise plan including everything in the Premium plan plus:</p><hr style="color:#E14E3A;background-color:#E14E3A;border:0;height:2px"/><ul><li><strong>24/7 access to core members of the Actionhero Team</strong></li><li><strong>Emergency response packages</strong></li><li><strong>Deployment support</strong></li><li><strong>...and custom development against Actionhero’s core as needed.</strong></li></ul><br/><div><button style="font-family:Roboto, sans-serif;font-weight:300;font-size:14px;max-width:200px;border-radius:50px;margin:0 auto;color:#FFFFFF;background-color:#E14E3A;border-color:#E14E3A;margin-top:20px;margin-bottom:20px;padding-top:15px;padding-bottom:15px;outline:none" type="button" class="btn btn-lg btn-default btn-block">Contact Us</button></div></div></div></div></div></div></div><div style="padding-left:0;padding-right:0;font-family:Roboto, sans-serif;font-size:14px;font-weight:300" class="container-fluid"><footer id="footer-container" style="background-color:#2F5266;color:#FBF9E4;font-family:Roboto, sans-serif;font-weight:200"><div class="container"><div style="padding-bottom:50px;padding-top:50px;padding-left:100px" class="row"><div class="col-md-12"><img src="/static/images/actionhero-logo-header-wordmark.svg"/></div></div><div style="padding-bottom:100px" class="row"><div class="col-md-4"><div style="padding-left:100px"><p><a style="color:#FBF9E4" href="/terms">Terms</a></p><p>Contact us at<!-- --> <a style="color:#FBF9E4;font-weight:500" href="mailto:hello@actionherojs.com">hello@actionherojs.com</a></p><p><a href="https://medium.com/tag/actionherojs/latest" target="_new" style="color:#FBF9E4">Blogs</a></p><p>© 2019<!-- --> <!-- -->Actionhero</p></div></div><div class="col-md-4"><div style="padding-left:100px"><p><a style="color:#FBF9E4" href="/why">Why Actionhero</a></p><p><a style="color:#FBF9E4" href="/get-started">Get Started</a></p><p><a href="https://docs.actionherojs.com" style="color:#FBF9E4">Documenation</a></p><p><a style="color:#FBF9E4" href="/solutions">Solutions</a></p><p><a style="color:#FBF9E4" href="/community">Community</a></p><p><a style="color:#FBF9E4" href="/downloads">Downloads</a></p></div></div><div class="col-md-4"><div style="padding-left:100px"><p><a href="https://www.npmjs.com/package/Actionhero" target="_new" style="color:#FBF9E4">NPM</a></p><p><a href="https://twitter.com/actionherojs" target="_new" style="color:#FBF9E4">Twitter</a></p><p><a href="https://slack.actionherojs.com/" target="_new" style="color:#FBF9E4">Slack</a></p><p><a href="https://github.com/Actionhero/Actionhero" target="_new" style="color:#FBF9E4">Github</a></p><p><a href="https://actionherojs.threadless.com" target="_new" style="color:#FBF9E4">Shop</a></p></div></div></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{"markdown":"## Overview\n\nUpgrading big Actionhero projects to a new major might require some effort. Every Actionhero version has it's own specific project files which you generate using `Actionhero generate` command.\n\nOne of the ways to upgrade your project is to generate a new project using the latest Actionhero framework (`npm install Actionhero \u0026\u0026 npx Actionhero generate`). Using that as your starting point you can then carefully copy all your `configs`, `initializers`, `servers`, `tasks`, `actions`, and other custom code from your old project, making sure that you are at the same working state as before. It's a good practice to make tests for your actions (or any other component) before you plan to upgrade your Actionhero project.\n\nWith good [test coverage](tutorial-testing.html) you can make sure that you have successfully upgraded your project.\n\nActionhero follows [semantic versioning](http://semver.org/). This means that a minor change is a right-most number. A new feature added is the middle number, and a breaking change is the left number. You should expect something in your application to need to be changed if you upgrade a major version.\n\n## Upgrading from v20 to v21\n\nWIP: This is a large change to Typescript. Detailed notes can be found on the Typescript page.\n\n## Upgrading from v19 to v20\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v20.0.0)**\n\nThe only change to take note of is that you must now ensure that the working directory (CWD/PWD) in use when you start your Actionhero project is the root. (where /config, /actions, etc) are visable.\n\n## Upgrading from v18 to v19\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v19.0.0)**\n\n**Configuration**\n\n- in `config/tasks.js` `add api.config.tasks.stuckWorkerTimeout = 3600000`. This will be a 1 hour timeout for stuck/crashed worker processes\n- in `config/servers/websocket.js` `add api.config.servers.websocket.client.cookieKey = api.config.servers.web.fingerprintOptions.cookieKey`. This will instruct the Actionhero Websocket Clients to share the same cookie as the web server to share a fingerprint, which can be used to share session information.\n- If you plan to use Jest for your tests, and want to test in parallel, you will need to configure your server in the test environment to make use of `process.env.JEST_WORKER_ID`. Please view [`config/api.js`](https://github.com/Actionhero/Actionhero/blob/master/config/api.js), [`config/redis.js`](https://github.com/Actionhero/Actionhero/blob/master/config/redis.js), [`config/servers/socket.js`](https://github.com/Actionhero/Actionhero/blob/master/config/servers/socket.js), and [`config/servers/web.js`](https://github.com/Actionhero/Actionhero/blob/master/config/servers/web.js) for more information\n\n## Upgrading from v19 to v20\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v20.0.0)**\n\n- In `config/api.js` add `api.config.general.paths.test = [path.join(__dirname, '/../__tests__')]` so that when you generate a new action or task, the related test file can be generated as well.\n- However you run Actionhero, be sure to `cd` into the root directory of the project before starting the server.\n\n## Upgrading from v19 to v20\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v19.0.0)**\n\n- in `config/tasks.js` `add api.config.tasks.stuckWorkerTimeout = 3600000`. This will be a 1 hour timeout for stuck/crashed worker processes\n- in `config/servers/websocket.js` `add api.config.servers.websocket.client.cookieKey = api.config.servers.web.fingerprintOptions.cookieKey`. This will instruct the Actionhero Websocket Clients to share the same cookie as the web server to share a fingerprint, which can be used to share session information.\n- If you plan to use Jest for your tests, and want to test in parallel, you will need to configure your server in the test environment to make use of `process.env.JEST_WORKER_ID`. Please view [`config/api.js`](https://github.com/Actionhero/Actionhero/blob/master/config/api.js), [`config/redis.js`](https://github.com/Actionhero/Actionhero/blob/master/config/redis.js), [`config/servers/socket.js`](https://github.com/Actionhero/Actionhero/blob/master/config/servers/socket.js), and [`config/servers/web.js`](https://github.com/Actionhero/Actionhero/blob/master/config/servers/web.js) for more information\n\n## Upgrading from v17 to v18\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v18.0.0)**\n\n**Breaking Changes and How to Overcome Them:**\n\nThere are _many_ changes to the APIs Actionhero exposes. You can read up on the new syntax on our [new documentation website, docs.actionherojs.com](https://docs.actionherojs.com)\n\n- **Node.js version**\n\n  - Node.js v8 and higher is now required. You must update your projects.\n\n- **Actions**\n  - Actions are now ES6 classes, which extend `require('Actionhero').Action`.\n  - The `run` method only has one argument now, `data` and becomes a `async` method. `api` can be required globally to your file.\n\n```js\nconst { Action, api } = require(\"Actionhero\");\n\nmodule.exports = class MyAction extends Action {\n  constructor() {\n    super();\n    this.name = \"randomNumber\";\n    this.description = \"I am an API method which will generate a random number\";\n    this.outputExample = { randomNumber: 0.1234 };\n  }\n\n  async run(data) {\n    data.response.randomNumber = Math.random();\n  }\n};\n```\n\n- **Tasks**\n  - Tasks are now ES6 classes, which extend `require('Actionhero').Task`.\n  - The `run` method only has one argument now, `data` and becomes a `async` method. `api` can be required globally to your file.\n\n```js\nconst { api, Task } = require(\"Actionhero\");\n\nmodule.exports = class SendWelcomeMessage extends Task {\n  constructor() {\n    super();\n    this.name = \"SendWelcomeEmail\";\n    this.description = \"I send the welcome email to new users\";\n    this.frequency = 0;\n    this.queue = \"high\";\n    this.middleware = [];\n  }\n\n  async run(data) {\n    await api.sendWelcomeEamail({ address: data.email });\n    return true;\n  }\n};\n```\n\n- **Initializers**\n  - Initializers are now ES6 classes, which extend `require('Actionhero').Initializer`.\n  - The `initialize`, `start`, and `stop` methods now have no arguments and become a `async` methods. `api` can be required globally to your file.\n\n```js\nconst { Actionhero, api } = require(\"Actionhero\");\n\nmodule.exports = class StuffInit extends Actionhero.Initializer {\n  constructor() {\n    super();\n    this.name = \"StuffInit\";\n    this.loadPriority = 1000;\n    this.startPriority = 1000;\n    this.stopPriority = 1000;\n  }\n\n  async initialize() {\n    api.StuffInit = {};\n    api.StuffInit.doAThing = async () =\u003e {};\n    api.StuffInit.stopStuff = async () =\u003e {};\n    api.log(\"I initialized\", \"debug\", this.name);\n  }\n\n  async start() {\n    await api.StuffInit.startStuff();\n    api.log(\"I started\", \"debug\", this.name);\n  }\n\n  async stop() {\n    await api.StuffInit.stopStuff();\n    api.log(\"I stopped\", \"debug\", this.name);\n  }\n};\n```\n\n- **Servers**\n  - Servers are now ES6 classes, which extend `require('Actionhero').Server`.\n  - The `initialize`, `start`, and `stop` methods now have no arguments and become a `async` methods. `api` can be required globally to your file.\n\n```js\nconst Actionhero = require(\"Actionhero\");\n\nmodule.exports = class MyServer extends Actionhero.Server {\n  constructor() {\n    super();\n    this.type = \"%%name%%\";\n\n    this.attributes = {\n      canChat: false,\n      logConnections: true,\n      logExits: true,\n      sendWelcomeMessage: false,\n      verbs: []\n    };\n    // this.config will be set to equal api.config.servers[this.type]\n  }\n\n  initialize() {\n    this.on(\"connection\", conection =\u003e {});\n\n    this.on(\"actionComplete\", data =\u003e {});\n  }\n\n  start() {\n    // this.buildConnection (data)\n    // this.processAction (connection)\n    // this.processFile (connection)\n  }\n\n  stop() {}\n\n  sendMessage(connection, message, messageId) {}\n\n  sendFile(connection, error, fileStream, mime, length, lastModified) {}\n\n  goodbye(connection) {}\n};\n```\n\n- **CLI Commands**\n  - CLI Commands are now ES6 classes, which extend `require('Actionhero').CLI`.\n  - The `run` method now has one argument, `data` and becomes a `async` method. `api` can be required globally to your file.\n\n```js\nconst {api, CLI} = require('Actionhero')\n\nmodule.exports = class RedisKeys extends CLI {\n  constructor () {\n    super()\n    this.name = 'redis keys'\n    this.description = 'I list all the keys in redis'\n    this.example = 'Actionhero keys --prefix Actionhero'\n  }\n\n  inputs () {\n    return {\n      prefix: {\n        requried: true,\n        default: 'Actionhero',\n        note: 'the redis prefix for searching keys'\n      }\n    }\n  }\n\n  async run ({params}) =\u003e {\n    let keys = await api.redis.clients.client.keys(params.prefix)\n    api.log('Found ' + keys.length + 'keys:')\n    keys.forEach((k) =\u003e { api.log(k) })\n  }\n}\n```\n\n- **Cache**\n\n  - All methods which used to return a callback are now `async` methods which, when `await`ed, return a result and `throw` errors\n\n- **Tasks**\n\n  - All methods which used to return a callback are now `async` methods which, when `await`ed, return a result and `throw` errors\n\n- **Chat**\n\n  - All methods which used to return a callback are now `async` methods which, when `await`ed, return a result and `throw` errors\n\n- **SpecHelper**\n  - All methods which used to return a callback are now `async` methods which, when `await`ed, return a result and `throw` errors\n\n```js\nconst chai = require(\"chai\");\nconst dirtyChai = require(\"dirty-chai\");\nconst expect = chai.expect;\nchai.use(dirtyChai);\n\nconst path = require(\"path\");\nconst Actionhero = require(\"Actionhero\");\nconst Actionhero = new Actionhero.Process();\nlet api;\n\ndescribe(\"Action: RandomNumber\", () =\u003e {\n  before(async () =\u003e {\n    api = await Actionhero.start();\n  });\n  after(async () =\u003e {\n    await Actionhero.stop();\n  });\n\n  let firstNumber = null;\n  it(\"generates random numbers\", async () =\u003e {\n    let { randomNumber } = await api.specHelper.runAction(\"randomNumber\");\n    expect(randomNumber).to.be.at.least(0);\n    expect(randomNumber).to.be.at.most(1);\n    firstNumber = randomNumber;\n  });\n\n  it(\"is unique / random\", async () =\u003e {\n    let { randomNumber } = await api.specHelper.runAction(\"randomNumber\");\n    expect(randomNumber).to.be.at.least(0);\n    expect(randomNumber).to.be.at.most(1);\n    expect(randomNumber).not.to.equal(firstNumber);\n  });\n});\n```\n\n- **Utils**\n\n  - `api.utils.recursiveDirectoryGlob` has been removed in favor of the [glob package](https://github.com/isaacs/node-glob). Use this instead.\n  - All methods which used to return a callback are now `async` methods which, when `await`ed, return a result and `throw` errors\n\n- **Plugins**\n\n  - Actionhero no longer uses linkfiles to find plugins. If you have any in a `plugins` directory in your actions, tasks, config, or public folders, delete them.\n  - Plugins now need to be defined explicitly in a new `./config/plugins.js` config file. You should create one [per the example](https://github.com/Actionhero/Actionhero/blob/master/config/plugins.js)\n  - Removed `Actionhero link` and `Actionhero unlink` per the above.\n  - Added `Actionhero generate plugin`, a helper which you can use in an empty directory which will create a template plugin project\n  - Testing plugins is now simpler. [Read more about this on docs.actionherojs.com](https://docs.actionherojs.com/tutorial-plugins.html)\n\n- **Clients**\n  - `ActionheroClient` (the included client library for browser websocket clients) as been named a more clear `ActionheroWebsocketClient` to avoid ambiguity.\n  - The node sever-sever package has been renamed `Actionhero-node-client` to help clear up any confusion.\n\n## Upgrading from v16 to v17\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v17.0.0)**\n\n**Breaking Changes and How to Overcome Them:**\n\n- **Localization (i18n)**\n\n- In `./config/i18n.js` be sure to enable `objectNotation`, or else the new locale file will be gibberish to Actionhero\n- As of this release, Actionhero no longer localizes its log messages. This is done to simplify and speed up the logger methods. There is not mitigation path here without overwriting the `api.log()` method.\n\n- Any use of `%` interpolation should be removed from your logger strings. Favor native JS string templates.\n\n- Actionhero now ships with locale files by default.\n\n- You will need to acquire the [default locale file](https://github.com/Actionhero/Actionhero/blob/master/locales/en.json) and copy it into `./locales/en.json` within your project.\n- The error reporters have all been changed to use these new locale file and mustache-style syntax. Update your from the [default errors file](https://github.com/Actionhero/Actionhero/blob/master/config/errors.js)\n- The `welcomeMessage` and `goodbyeMessage` are removed from the config files and Actionhero now refrences the locale files for these strings. Update yours accodingly.\n\n- **utils**\n\n- `api.utils.recursiveDirectoryGlob` has been removed in favor of the [glob package](https://github.com/isaacs/node-glob). Use this instead.\n\n## Upgrading from v15 to v16\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v16.0.0)**\n\n**Breaking Changes and How to Overcome Them:**\n\nThe only breaking changes are related to the capilization of internal methods:\n\n- `api.Connecton()` rather than `api.connection()`\n- `api.GenericServer()` rather than `api.genericServer()`\n- `api.ActionProcessor()` rather than `api.actionProcessor()`\n- `require('Actionhero')` not `require('Actionhero').actionheroPrototype` should you be using Actionhero programatically.\n\n## Upgrading from v14 to v15\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v15.0.0)**\n\n**Breaking Changes and How to Overcome Them:**\n\n```bash\n\\`Actionhero generateAction --name=[name]\\`      -\u003e \\`Actionhero generate action --name=[name]\\`\n\\`Actionhero generateInitializer --name=[name]\\` -\u003e \\`Actionhero generate initializer --name=[name]\\`\n\\`Actionhero generateServer --name=[name]\\`      -\u003e \\`Actionhero generate server --name=[name]\\`\n\\`Actionhero generateTask --name=[name]\\`        -\u003e \\`Actionhero generate task --name=[name]\\`\n```\n\n- The Actionhero binary has had it's commands changed.\n  - Any deployment or automation tools you use will need to be updated accordingly.\n- Tasks now use middleware instead of plugins.\n  - You will need to convert all uses of task plugins to task middleware.\n\n## Upgrading from v13 to v14\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v14.0.0)**\n\n**Breaking Changes and How to Overcome Them:**\n\n- Redis Client Configurations have changed drastically. This allows for greater configuration, but at a complexity cost.\n  - The easiest way to upgrade your `config/redis.js` is to take if from the [master branch](https://github.com/Actionhero/Actionhero/blob/master/config/redis.js) directly and re-apply your configuration.\n  - Move `api.config.redis.channel` to `api.config.general.channel`\n  - Move `api.config.redis. rpcTimeout` to `api.config.general.rpcTimeout`\n  - Throughout the code, use `api.config.redis.client` rather than `api.redis.client`\n\n## Upgrading from v12 to v13\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v13.0.0)**\n\n**Breaking Changes and How to Overcome Them:**\n\n- Pluggins\n  - `config/plugins.js` is removed. Delete yours.\n  - Use the new binary command, `Actionhero link --name=NameOfPlugin` to link your plugins in the new method.\n  - Linking plugins will likley create new config files you may need to customize.\n- Locales\n  - This release introduced Locales. You will need the new locale config file. The easiest way to upgrade your `config/i18n.js` is to take if from the [master branch](https://github.com/Actionhero/Actionhero/blob/master/config/i18n.js).\n  - Ensure that `api.config.i18n.updateFiles` is `true` so that your locale files can be generated for the first time.\n- Errors\n  - `config/errors.js` has been completely redone to take advantage of `connection.localize`. The easiest way to upgrade your `config/errors.js` is to take if from the [master branch](https://github.com/Actionhero/Actionhero/blob/master/config/errors.js).\n- Grunt Removed\n  - Grunt is removed from the project. The old Actionhero grunt commands have been moved into the Actionhero binary.\n- Redis configuration\n  - `package` is a reserved keyword in JavaScript. We now use the key `pkg` in the redis config.\n\n## Upgrading from v11 to v12\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v12.0.0)**\n\n**Breaking Changes and How to Overcome Them:**\n\n- Redis configuration\n  - Switch from using the `redis` npm pacakge to `ioredis`. Change this in your package.json.\n- `ioredis` handles passwords slightly differently. Read the [ioredis](https://github.com/luin/ioredis) documentation to learn more.\n- Stats Removed\n  - The `api.stats` subsection has been removed from Actionhero\n  - If you need the stats subsection, you can get get it [via plugin](https://github.com/Actionhero/ah-stats-plugin)\n\n## Upgrading from v10 to v11\n\n**Full Release Notes: [GitHub](https://github.com/Actionhero/Actionhero/releases/tag/v11.0.0)**\n\n**Breaking Changes and How to Overcome Them:**\n\n- Action Syntax changed\n  - `run: function(api, data, next){ data.response.randomNumber = Math.random(); next(error); }`\n  - Where data contains:\n  - `data = { connection: connection, action: 'randomNumber', toProcess: true, toRender: true, messageId: 123, params: { action: 'randomNumber', apiVersion: 1 }, actionStartTime: 123, response: {}, }`\n  - You will need to change all of your actions to use `data.connection` rather than `connection` directly.\n  - You will need to change all of your actions to use `data.response` rather than `connection.response` directly.\n- Middleware syntax has changed to match action's `data` pattern. You will need to change your middleware accordingly.\n- Removed `connection._originalConnection`.\n- Websockets:\n  - The params of websocket connections should NOT be sticky. All actions will start with `connection.params = {}`. If you rely on the old behavior, you will need to change your client code.\n- Action Processor:\n  - Removed duplicate callback prevention in ActionProcessor. This belongs on the user/implementer to handle.\n","name":"upgrade-path"}},"page":"/tutorials/[name]","query":{"name":"upgrade-path"},"buildId":"LBfMmkKIbhjxYUodTJOk3","nextExport":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-099147a670e7b68459d6.js"></script><script async="" data-next-page="/tutorials/[name]" src="/_next/static/LBfMmkKIbhjxYUodTJOk3/pages/tutorials/%5Bname%5D.js"></script><script async="" data-next-page="/_app" src="/_next/static/LBfMmkKIbhjxYUodTJOk3/pages/_app.js"></script><script src="/_next/static/runtime/webpack-08f7b238829422e3b9b2.js" async=""></script><script src="/_next/static/chunks/commons.205aac1996ebb87d3a48.js" async=""></script><script src="/_next/static/runtime/main-2325b25da04a50e601b5.js" async=""></script></body></html>